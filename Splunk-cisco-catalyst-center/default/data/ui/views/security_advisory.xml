<form version="1.1">
  <label>Security Advisory</label>
  <description>This dashboard provides an overview of security advisories detected in the Cisco Catalyst network.</description>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="timeRangePicker7" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="ciscocatalysthostDropdown" searchWhenChanged="true">
      <label>Cisco Catalyst Center Host</label>
      <fieldForLabel>cisco_catalyst_host</fieldForLabel>
      <fieldForValue>cisco_catalyst_host</fieldForValue>
      <search>
        <query>sourcetype="cisco:catalyst:securityadvisory" | stats values(cisco_catalyst_host) AS cisco_catalyst_host | mvexpand cisco_catalyst_host</query>
        <earliest>$timeRangePicker7.earliest$</earliest>
        <latest>now</latest>
      </search>
      <selectFirstChoice>true</selectFirstChoice>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Critical Count</title>
      <single>
        <title>Site: Global</title>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="True"  SubCategory="Total" Category="CRITICAL"
          | chart avg(Amount) by _time</query>
          <earliest>$timeRangePicker7.earliest$</earliest>
          <latest>$timeRangePicker7.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051", "0x0877a6", "0xf8be34", "0xf1813f", "0xdc4e41"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title>High Count</title>
      <single>
        <title>Site: Global</title>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="True" SubCategory="Total" Category="HIGH"
          | chart avg(Amount) by _time</query>
          <earliest>$timeRangePicker7.earliest$</earliest>
          <latest>$timeRangePicker7.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051", "0x0877a6", "0xf8be34", "0xf1813f", "0xdc4e41"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title>Medium Count</title>
      <single>
        <title>Site: Global</title>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="True" SubCategory="Total" Category="MEDIUM"
          | chart avg(Amount) by _time</query>
          <earliest>$timeRangePicker7.earliest$</earliest>
          <latest>$timeRangePicker7.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051", "0x0877a6", "0xf8be34", "0xf1813f", "0xdc4e41"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Security Advisories Count by Category</title>
      <chart>
        <title>Site: Global</title>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="True"  SubCategory="Total"
          | dedup Category keepevents=false
          | chart sum(Amount) as amount by Category</query>
          <earliest>$timeRangePicker7.earliest$</earliest>
          <latest>$timeRangePicker7.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <title>Security Advisories by Category</title>
      <chart>
        <title>Site: Global</title>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="True" SubCategory="Total"
          | chart avg(Amount) as amount by _time, Category</query>
          <earliest>$timeRangePicker7.earliest$</earliest>
          <latest>$timeRangePicker7.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">seriesCompare</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Security Advisories Count by Subcategory</title>
      <input type="dropdown" token="categoryDropdown" searchWhenChanged="true">
        <label>Category</label>
        <fieldForLabel>Category</fieldForLabel>
        <fieldForValue>Category</fieldForValue>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="True" SubCategory!="Total" | dedup Category keepevents=false | table Category</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <selectFirstChoice>true</selectFirstChoice>
      </input>
      <chart>
        <title>Site: Global</title>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="True" SubCategory!="Total" Category="$categoryDropdown$"
          | dedup SubCategory keepevents=false
          | chart sum(Amount) as amount by SubCategory
          | eventstats sum(amount) as Total
          | eval perc=round((amount/Total)*100, 2)
          | eval SubCategory=SubCategory." (".perc."%)"
          | table SubCategory amount</query>
          <earliest>$timeRangePicker7.earliest$</earliest>
          <latest>$timeRangePicker7.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <title>Security Advisories by Subcategory</title>
      <input type="dropdown" token="categoryDropdown2" searchWhenChanged="true">
        <label>Category</label>
        <fieldForLabel>Category</fieldForLabel>
        <fieldForValue>Category</fieldForValue>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="True" SubCategory!="Total" | dedup Category keepevents=false | table Category</query>
        </search>
        <selectFirstChoice>true</selectFirstChoice>
      </input>
      <chart>
        <title>Site: Global</title>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="True" SubCategory!="Total" Category="$categoryDropdown2$"
          | chart avg(Amount) as amount by _time, SubCategory</query>
          <earliest>$timeRangePicker7.earliest$</earliest>
          <latest>$timeRangePicker7.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">seriesCompare</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Security Advisories with Devices</title>
      <input type="dropdown" token="deviceHostNameDropdown" searchWhenChanged="true">
        <label>Device Name</label>
        <choice value="*">All</choice>
        <initialValue>*</initialValue>
        <fieldForLabel>DeviceName</fieldForLabel>
        <fieldForValue>DeviceName</fieldForValue>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" | dedup DeviceName keepevents=false | table DeviceName</query>
          <earliest>$timeRangePicker7.earliest$</earliest>
          <latest>now</latest>
        </search>
        <default>*</default>
      </input>
      <input type="dropdown" token="ipAddressDropdown" searchWhenChanged="true">
        <label>IP Address</label>
        <choice value="*">All</choice>
        <fieldForLabel>DeviceIpAddress</fieldForLabel>
        <fieldForValue>DeviceIpAddress</fieldForValue>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="False" | dedup DeviceIpAddress keepevents=false | table DeviceIpAddress</query>
          <earliest>$timeRangePicker7.earliest$</earliest>
          <latest>now</latest>
        </search>
        <default>*</default>
      </input>
      <input type="dropdown" token="advisoryIDDropdown" searchWhenChanged="true">
        <label>Advisory ID</label>
        <choice value="*">All</choice>
        <fieldForLabel>AdvisoryID</fieldForLabel>
        <fieldForValue>AdvisoryID</fieldForValue>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="False" | dedup AdvisoryID keepevents=false | table AdvisoryID</query>
          <earliest>$timeRangePicker7.earliest$</earliest>
          <latest>now</latest>
        </search>
        <default>*</default>
      </input>
      <input type="text" token="siteFilter" searchWhenChanged="true">
        <label>Site</label>
        <default>Global</default>
      </input>
      <table>
        <title>Site: $siteFilter$</title>
        <search>
          <query>sourcetype="cisco:catalyst:securityadvisory" cisco_catalyst_host="$ciscocatalysthostDropdown$" Summary="False" DeviceName="$deviceHostNameDropdown$" DeviceIpAddress="$ipAddressDropdown$" AdvisoryID="$advisoryIDDropdown$"
          | dedup AdvisoryID keepevents=false
          | where "$siteFilter$"=="Global" OR lower(Site) LIKE lower("%$siteFilter$%")
          | eval DeviceUptime = tostring(DeviceUptimeSeconds, "duration")
          | eval ciscocatalysthostip=replace("$ciscocatalysthostDropdown$", "https://", "")
          | eval URL="https://"+ciscocatalysthostip+"/dna/assurance/device/details?emptyDevice=false&amp;id="+DeviceID
          | eval URL2="https://"+ciscocatalysthostip+"/dna/assurance/client/details?macAddress="+DeviceMACAddress
          | rename AdvisoryID as "Advisory ID", AdvisoryCvesStr as "Advisory CVEs", AdvisoryDefaultDetectionType as "Advisory Default Detection Type", AdvisoryDetectionType as "Advisory Detection Type", AdvisoryPublicationUrl as "Advisory Publication URL", AdvisorySir as "Advisory SIR", DeviceIpAddress as "IP Address", DeviceName as "Device Name", DeviceMACAddress as "Device MAC Address", DeviceSerialNumber as "Device Serial Number", DeviceFamily as "Device Family", DevicePlatform as "Device Platform", DeviceSeries as "Device Series", DeviceUptime as "Device Uptime"
          | table DeviceID, "Device Name", "IP Address", "Advisory ID", "Advisory CVEs", "Advisory Default Detection Type", "Advisory Detection Type", "Advisory Publication URL", "Advisory SIR", "Device MAC Address", "Device Serial Number", "Device Family", "Device Platform", "Device Series", "Device Uptime", URL, URL2, Site</query>
          <earliest>$timeRangePicker7.earliest$</earliest>
          <latest>$timeRangePicker7.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <option name="drilldown">cell</option>
        <fields>"Device Name", "IP Address", "Advisory ID", "Advisory CVEs", "Advisory Default Detection Type", "Advisory Detection Type", "Advisory Publication URL", "Advisory SIR", "Device MAC Address", "Device Serial Number", "Device Family", "Device Platform", "Device Series", "Device Uptime", Site</fields>
        <drilldown>
          <condition field="Device Name">
            <link target="_blank">$row.URL|n$</link>
          </condition>
          <condition field="Advisory Publication URL">
            <link target="_blank">$click.value2|n$</link>
          </condition>
          <condition field="Device MAC Address">
            <link target="_blank">$row.URL2|n$</link>
          </condition>
          <condition field="*"/>
        </drilldown>
      </table>
    </panel>
  </row>
</form>